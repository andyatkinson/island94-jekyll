<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Island94.org</title>
  <meta name="description" content="A Lost and Found
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://island94.org/">
  <link rel="alternate" type="application/rss+xml" title="Island94.org" href="http://island94.org/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Island94.org</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

  <h1 class="page-heading">Posts</h1>

  <ul class="post-list">
    
      <li>
        <span class="post-meta">Mar 25, 2016</span>

        <h2>
          <a class="post-link" href="/jekyll/update/2016/03/25/welcome-to-jekyll.html">Welcome to Jekyll!</a>
        </h2>

        <div class="post-content" itemprop="articleBody">
          <p>You’ll find this post in your <code class="highlighter-rouge">_posts</code> directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run <code class="highlighter-rouge">jekyll serve</code>, which launches a web server and auto-regenerates your site when a file is updated.</p>

<p>To add new posts, simply add a file in the <code class="highlighter-rouge">_posts</code> directory that follows the convention <code class="highlighter-rouge">YYYY-MM-DD-name-of-post.ext</code> and includes the necessary front matter. Take a look at the source for this post to get an idea about how it works.</p>

<p>Jekyll also offers powerful support for code snippets:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">print_hi</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Hi, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
<span class="n">print_hi</span><span class="p">(</span><span class="s1">'Tom'</span><span class="p">)</span>
<span class="c1">#=&gt; prints 'Hi, Tom' to STDOUT.</span></code></pre></figure>

<p>Check out the <a href="http://jekyllrb.com/docs/home">Jekyll docs</a> for more info on how to get the most out of Jekyll. File all bugs/feature requests at <a href="https://github.com/jekyll/jekyll">Jekyll’s GitHub repo</a>. If you have questions, you can ask them on <a href="https://talk.jekyllrb.com/">Jekyll Talk</a>.</p>


        </div>
      </li>
    
      <li>
        <span class="post-meta">Aug 2, 2007</span>

        <h2>
          <a class="post-link" href="/2007/08/02/Geekout-Video-on-Maps-for-Cable-Access-TV.html.html">Geekout: Video on Maps for Cable Access TV</a>
        </h2>

        <div class="post-content" itemprop="articleBody">
          <p><img src="/assets/2007-08/mediamap-600x448.jpg" alt="" title="mediamap" /></p>

<p>I recently did some <a href="http://drupal.org">Drupal</a> development work for <a href="http://cctvcambridge.org">Cambridge Community Television</a>. As part of the really amazing work they are doing combining new media with traditional <a href="http://alliancecm.org">Cable Access Television</a>, CCTV has been mapping videos their members produce. They call this project the <a href="http://cctvcambridge.org/mediamap">Mediamap</a>.</p>

<p>I was really excited to work on the Mediamap with CCTV because of my long <a href="http://island94.org/articles/future-cable-access">involvement</a> with Cable Access Television, most notably the now-defunct <a href="http://digitalbicycle.org">DigitalBicycle Project</a> and the community maintained directory of Cable Access Stations I built and administer: <a href="http://mappingaccess.com">MappingAccess.com</a>.</p>

<p>Despite CCTV running their website on Drupal, their first proof-of-concept version of the Mediamap was created manually, using the very capable <a href="http://mapbuilder.net">Mapbuilder.net</a> service and copy-and-pasted embedded flash video. While simple from a technological standpoint, they were running to problems optimizing the workflow of updating the map; changes had to be made via the Mapbuilder.net interface, with a single username and password, then manually parsed to remove some coding irregularities, and finally copy and pasted whole into a page on their website.</p>

<p>I was asked to improve the workflow and ultimately take fuller advantage of Drupal’s built-in user management and content management features. For instance, taking advantage of CCTV’s current member submitted video capabilities and flowing them into the map as an integrated report, not a separate and parallel system.</p>

<p>In my discussions with them, a couple of issues came up. Foremost was that CCTV was running an older version of Drupal: 4.7. While still quite powerful, many newer features and contributed modules were not available for this earlier release. The current version of Drupal, 5.1, has many rich, well-developed utilities for creating reports and mapping them: <a href="http://drupal.org/project/cck">Content Construction Kit (CCK)</a> + <a href="http://drupal.org/project/views">Views</a> + <a href="http://drupal.org/project/gmap">Gmap</a> + <a href="http://drupal.org/project/location">Location</a>. As it was though, with the older version, I would have to develop the additional functionality manually.</p>

<p>The following is a description, with code examples, of the functionality I created for the Mediamap. Additionally, following this initial development, CCTV upgraded their Drupal installation to 5.1, giving me the opportunity to demonstrate the ease and power of Drupal’s most recent release—rendering blissfully obsolete most of the custom coding I had done.</p>

<p>Location and Gmap was used in both versions for storing geographic data and hooking into the Google Map API. One of Drupal’s great strengths is the both the diversity of contributed modules, and the flexibility with which a developer can use them.</p>

<h3 id="adding-additional-content-fields">Adding additional content fields</h3>

<p>CCTV already has a process in which member’s can submit content nodes. In 4.7, the easiest way to add additional data fields to these was with a custom <a href="http://api.drupal.org/api/file/nodeapi_example.module/4.7">NodeAPI module</a>. CCTV was interested in using embedded flash video, primarily from <a href="http://blip.tv">Blip.tv</a>, but also Google Video or YouTube if the flexibility was needed. To simplify the process, we decided on just adding the cut-and-paste embed code to a custom content field in existing nodes.</p>

<p>To do this, I created a new module that invoked hook_nodeapi:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/\*\*\ * Implementation of hook_nodeapi\ * /

function cambridge_mediamap_nodeapi(<span class="err">&amp;</span>$node, $op, $teaser, $page) {
  switch ($op) {
    case 'validate':
      if (variable_get('cambridge_mediamap_'.$node - &gt; type, TRUE)) {
        if (user_access('modify node data')) {
          if ($node - &gt; cambridge_mediamap['display'] <span class="err">&amp;&amp;</span> $node - &gt; cambridge_mediamap['embed'] == '') {
            form_set_error('cambridge_mediamap', t('Media Map: You must enter embed code or disable display of this node on the map'));
          }
        }
      }
      break;
    case 'load':
      $object = db_fetch_object(db_query('SELECT display, embed FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid));
      $embed = $object - &gt; embed;
      $embed_resize = cambridge_mediamap_resize($embed);
      return array('cambridge_mediamap' =&gt; array('display' =&gt; $object - &gt; display, 'embed' =&gt; $embed, 'embed_resize' =&gt; $embed_resize, ));
      break;
    case 'insert':
      db_query("INSERT INTO {cambridge_mediamap} (nid, display, embed) VALUES (%d, %d, '%s')", $node - &gt; nid, $node - &gt; cambridge_mediamap['display'], $node - &gt; cambridge_mediamap['embed']);
      break;
    case 'update':
      db_query('DELETE FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid);
      db_query("INSERT INTO {cambridge_mediamap} (nid, display, embed) VALUES (%d, %d, '%s')", $node - &gt; nid, $node - &gt; cambridge_mediamap['display'], $node - &gt; cambridge_mediamap['embed']);
      break;
    case 'delete':
      db_query('DELETE FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid);
      break;  
    case 'view':
      break;
  }
}
</code></pre>
</div>

<p>As you can see, there is a considerable amount of coding required, from defining the form, validating input and configuring database storage and retrieval calls.</p>

<p>Now that we have the glue for the custom field, we have to configure what node types that custom field appears on. Additionally, we need to set up administrative settings to configure where that custom field will appear, and lastly insert that field into the node edit screen:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
\**
 * Implementation of hook_form_alter
 */
function cambridge_mediamap_nodeapi( <span class="err">&amp;</span> $node, $op, $teaser, $page) {
  switch ($op) {
    case 'validate':
      if (variable_get('cambridge_mediamap_'.$node - &gt; type, TRUE)) {
        if (user_access('modify node data')) {
          if ($node - &gt; cambridge_mediamap['display'] <span class="err">&amp;&amp;</span> $node - &gt; cambridge_mediamap['embed'] == '') {
            form_set_error('cambridge_mediamap', t('Media Map: You must enter embed code or disable display of this node on the map'));
          }
        }
      }
      break;
    case 'load':
      $object = db_fetch_object(db_query('SELECT display, embed FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid));
      $embed = $object - &gt; embed;
      $embed_resize = cambridge_mediamap_resize($embed);
      return array(
        'cambridge_mediamap' =&gt; array(
          'display' =&gt; $object - &gt; display,
          'embed' =&gt; $embed,
          'embed_resize' =&gt; $embed_resize,
        )
      );
      break;
    case 'insert':
      db_query("INSERT INTO {cambridge_mediamap} (nid, display, embed) VALUES (%d, %d, '%s')", $node - &gt; nid, $node - &gt; cambridge_mediamap['display'], $node - &gt; cambridge_mediamap['embed']);
      break;
    case 'update':
      db_query('DELETE FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid);
      db_query("INSERT INTO {cambridge_mediamap} (nid, display, embed) VALUES (%d, %d, '%s')", $node - &gt; nid, $node - &gt; cambridge_mediamap['display'], $node - &gt; cambridge_mediamap['embed']);
      break;
    case 'delete':
      db_query('DELETE FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid);
      break;
    case 'view':
      break;
  }
}
</code></pre>
</div>

<p>As you can see, that’s a lot of lines of code for what we essentially can do, in Drupal 5.1 with CCK. CCK allows you, graphically through the Drupal web-interface, to create a new content field and add it to a node type; it takes about a minute.</p>

<h3 id="building-the-map">Building the Map</h3>

<p>The primary goal of rebuilding the Mediamap using native Drupal was workflow optimization: it was frustrating to submit information both within Drupal and then recreate it within Mapbuilder. In essence, the map should be just another report of Drupal content: you may have a short bulleted list of the top five articles, a paginated history with teasers and author information, or a full-blown map, but most importantly, all of it is flowing dynamically out of the Drupal database.</p>

<p>The Gmap module provides many powerful ways to integrate the Google Map API with Drupal. While Gmap for 4.7 provides a default map of content it would not provide the features or customizability we desired with the Mediamap. Instead, one of the most powerful ways to use Gmap is to hook directly into the module’s own API-like functions:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>\**
 * A page callback to draw the map
 */

function cambridge_mediamap_map() {
  $output = '';
  //Collect the nodes to be displayed
  $results = db_query('SELECT embed, nid FROM {cambridge_mediamap} WHERE display = 1');
  //Initialize our marker array
  $markers = array();
  //check to see what modules are enabled
  $location_enabled = module_exist('location');
  $gmap_location_enabled = module_exist('gmap_location');
  //load each node and set it's attributes in the marker array
  while ($item = db_fetch_object($results)) {
    $latitude = 0;
    $longitude = 0;
    //load the node
    $node = node_load(array('nid' =&gt; $item - &gt; nid));
    //set the latitude and longitude
    //give location module data preference over gmap module data
    if ($location_enabled) {
      $latitude = $node - &gt; location['latitude'];
      $longitude = $node - &gt; location['longitude'];
    }
    elseif($gmap_location_enabled) {
      $latitude = $node - &gt; gmap_location_latitude;
      $longitude = $node - &gt; gmap_location_longitude;
    }
    if ($latitude &amp;&amp; $longitude) {
      $markers[] = array(
        'label' =&gt; theme('cambridge_mediamap_marker', $node),
        'latitude' =&gt; $latitude,
        'longitude' =&gt; $longitude,
        'markername' =&gt; variable_get('cambridge_mediamap_default_marker', 'marker'),
      );
    }
  }
  $latlon = explode(',', variable_get('cambridge_mediamap_default_latlong', '42.369452,-71.100426'));
  $map = array(
    'id' =&gt; 'cambridge_mediamap',
    'latitude' =&gt; trim($latlon[0]),
    'longitude' =&gt; trim($latlon[1]),
    'width' =&gt; variable_get('cambridge_mediamap_default_width', '100%'),
    'height' =&gt; variable_get('cambridge_mediamap_default_height', '500px'),
    'zoom' =&gt; variable_get('cambridge_mediamap_default_zoom', 13),
    'control' =&gt; variable_get('cambridge_mediamap_default_control', 'Large'),
    'type' =&gt; variable_get('cambridge_mediamap_default_type', 'Satellite'),
    'markers' =&gt; $markers,
  );
   
  return gmap_draw_map($map);
}
</code></pre>
</div>

<p>As you can see, this is quite complicated. Drupal 5.1 offers the powerful Views module, which allows one to define custom reports, once again graphically from the Drupal web-interface, in just a couple minutes of configuration. The gmap_views module, which ships with Gmap, allows one to add those custom reports to a Google Map, which is incredibly useful and renders obsolete much of the development work I did.</p>

<h3 id="on-displaying-video-in-maps">On displaying video in maps</h3>

<p>In my discussions with CCTV, we felt it most pragmatic to use the embedded video code provided by video hosting services such as Blip.tv. While we could have used one of the Drupal video modules, we wanted the ability to host video offsite due to storage constraints. While I was concerned about the danger of code injection via minimally validated inputs, we felt that this would be of small danger because the content would be maintained by CCTV staff and select members.</p>

<p>The markers were themed using the embedded video field pulled from the Drupal database, along with the title and a snippet of the description, all linking back to the full content node.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/**
 * A theme function for our markers
 */
function theme_cambridge_mediamap_marker($node) {
  $output = '';
  $output. = '' . l($node-&gt;title, 'node / ' . $node-&gt;nid) . '';
  $output. = '' . $node-&gt;cambridge_mediamap[' . embed_resize '] . '';
  $output. = '';
  return $output;
}
</code></pre>
</div>

<p>With Drupal 5.1 and Views, we still had to override the standard marker themes, but this was simple and done through the standard methods.</p>

<p>One of the most helpful pieces was some code developed by <a href="http://circuitous.org">Rebecca White</a>, who I previously worked with on <a href="http://panlexicon.com">Panlexicon</a>. She provided the critical pieces of code that parsed the embedded video code and resized it for display on small marker windows.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/**

\* Returns a resized embed code

\*/
function cambridge_mediamap_resize($embed = '') {
  if (!$embed) {
    return '';
  }
  list($width, $height) = cambridge_mediamap_get_embed_size($embed);
  //width/height ratio
  $width_to_height = $width / $height;
  $max_width = variable_get('cambridge_mediamap_embed_width', '320');
  $max_height = variable_get('cambridge_mediamap_embed_height', '240');
  //shrink down widths while maintaining proportion
  if ($width &gt;= $height) {
    if ($width &gt; $max_width) {
      $width = $max_width;
      $height = (1 / $width_to_height)\ * $width;
    }
    if ($height &gt; $max_height) {
      $height = $max_height;
      $width = ($width_to_height)\ * $height;
    }
  } else {
    if ($height &gt; $max_height) {
      $height = $max_height;
      $width = ($width_to_height)\ * $height;
    }
    if ($width &gt; $max_width) {
      $width = $max_width;
      $height = (1 / $width_to_height)\ * $width;
    }
  }
  return cambridge_mediamap_set_embed_size($embed, intval($width), intval($height));
}
/\*\*\ * find out what size the embedded thing is\ * /

function cambridge_mediamap_get_embed_size($html) {
  preg_match('/]\*width(\s\*=\s\*"|:\s\*)(\d+)/i', $html, $match_width);
  preg_match('/]\*height(\s\*=\s\*"|:\s\*)(\d+)/i', $html, $match_height);
  return array($match_width[2], $match_height[2]);
}
/\*\*\ * set the size of the embeded thing\ * /

function cambridge_mediamap_set_embed_size($html, $width, $height) {
  $html = preg_replace('/(<span class="err">&lt;</span>(embed|object)\s[^&gt;]\*width(\s\*=\s\*"|:\s\*))(\d+)/i', '${1}'.$width, $html);
  $html = preg_replace('/(<span class="err">&lt;</span>(embed|object)\s[^&gt;]\*height(\s\*=\s\*"|:\s\*))(\d+)/i', '${1}'.$height, $html);
  return $html;
}
/\*\*\ * returns the base url of the src attribute.\*youtube = www.youtube.com\ * blip = blip.tv\ * google video = video.google.com\ * /

function cambridge_mediamap_get_embed_source($html) {
  preg_match('/]\*src="http:\/\/([^\/"]+)/i', $html, $match_src);
  return $match_src[1];
}
</code></pre>
</div>

<h3 id="the-wrap-up">The Wrap-Up</h3>

<p>While it may not seem so from the lines of code above, developing for Drupal is still relatively easy. Drupal provides a rich set of features for developers, <a href="http://api.drupal.org">well documented features</a>, and strong <a href="http://drupal.org/coding-standards">coding standards</a>—making reading other people’s code and learning from it incredibly productive.</p>

<p>Below is the entirety of the custom module I developed for the 4.7 version of the CCTV Media Map. Because it was custom and intended to be used in-house, many important, release worthy functions were omitted, such as richer administrative options and module/function verifications.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>'cambridge_mediamap', 'title' =&gt; t('Mediamap'), 'callback' =&gt; 'cambridge_mediamap_map', 'access' =&gt; user_access('access mediamap'), );
}
return $items;
}
/\*\*\ * Implementation of hook_nodeapi\ * /

function cambridge_mediamap_nodeapi( <span class="err">&amp;</span> $node, $op, $teaser, $page) {
  switch ($op) {
    case 'validate':
      if (variable_get('cambridge_mediamap_'.$node - &gt; type, TRUE)) {
        if (user_access('modify node data')) {
          if ($node - &gt; cambridge_mediamap['display'] <span class="err">&amp;&amp;</span> $node - &gt; cambridge_mediamap['embed'] == '') {
            form_set_error('cambridge_mediamap', t('Media Map: You must enter embed code or disable display of this node on the map'));
          }
        }
      }
      break;
    case 'load':
      $object = db_fetch_object(db_query('SELECT display, embed FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid));
      $embed = $object - &gt; embed;
      $embed_resize = cambridge_mediamap_resize($embed);
      return array('cambridge_mediamap' =&gt; array('display' =&gt; $object - &gt; display, 'embed' =&gt; $embed, 'embed_resize' =&gt; $embed_resize, ));
      break;
    case 'insert':
      db_query("INSERT INTO {cambridge_mediamap} (nid, display, embed) VALUES (%d, %d, '%s')", $node - &gt; nid, $node - &gt; cambridge_mediamap['display'], $node - &gt; cambridge_mediamap['embed']);
      break;
    case 'update':
      db_query('DELETE FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid);
      db_query("INSERT INTO {cambridge_mediamap} (nid, display, embed) VALUES (%d, %d, '%s')", $node - &gt; nid, $node - &gt; cambridge_mediamap['display'], $node - &gt; cambridge_mediamap['embed']);
      break;
    case 'delete':
      db_query('DELETE FROM {cambridge_mediamap} WHERE nid = %d', $node - &gt; nid);
      break;
    case 'view':
      break;
  }
}
/\*\*\ * Returns a resized embed code\ * /

function cambridge_mediamap_resize($embed = '') {
  if (!$embed) {
    return '';
  }
  list($width, $height) = cambridge_mediamap_get_embed_size($embed);
  //width/height ratio
  $width_to_height = $width / $height;
  $max_width = variable_get('cambridge_mediamap_embed_width', '320');
  $max_height = variable_get('cambridge_mediamap_embed_height', '240');
  //shrink down widths while maintaining proportion
  if ($width &gt;= $height) {
    if ($width &gt; $max_width) {
      $width = $max_width;
      $height = (1 / $width_to_height)\ * $width;
    }
    if ($height &gt; $max_height) {
      $height = $max_height;
      $width = ($width_to_height)\ * $height;
    }
  } else {
    if ($height &gt; $max_height) {
      $height = $max_height;
      $width = ($width_to_height)\ * $height;
    }
    if ($width &gt; $max_width) {
      $width = $max_width;
      $height = (1 / $width_to_height)\ * $width;
    }
  }
  return cambridge_mediamap_set_embed_size($embed, intval($width), intval($height));
}
/\*\*\ * find out what size the embedded thing is\ * /

function cambridge_mediamap_get_embed_size($html) {
  preg_match('/]\*width(\s\*=\s\*"|:\s\*)(\d+)/i', $html, $match_width);
  preg_match('/]\*height(\s\*=\s\*"|:\s\*)(\d+)/i', $html, $match_height);
  return array($match_width[2], $match_height[2]);
}
/\*\*\ * set the size of the embeded thing\ * /

function cambridge_mediamap_set_embed_size($html, $width, $height) {
  $html = preg_replace('/(<span class="err">&lt;</span>(embed|object)\s[^&gt;]\*width(\s\*=\s\*"|:\s\*))(\d+)/i', '${1}'.$width, $html);
  $html = preg_replace('/(<span class="err">&lt;</span>(embed|object)\s[^&gt;]\*height(\s\*=\s\*"|:\s\*))(\d+)/i', '${1}'.$height, $html);
  return $html;
}
/\*\*\ * returns the base url of the src attribute.\*youtube = www.youtube.com\ * blip = blip.tv\ * google video = video.google.com\ * /

function cambridge_mediamap_get_embed_source($html) {
  preg_match('/]\*src="http:\/\/([^\/"]+)/i', $html, $match_src);
  return $match_src[1];
}
/\*\*\ * Implementation of hook_form_alter\ * /

function cambridge_mediamap_form_alter($form_id, <span class="err">&amp;</span> $form) {
  // We're only modifying node forms, if the type field isn't set we don't need
  // to bother.
  if (!isset($form['type'])) {
    return;
  }
  //disable the Gmap module's location map for unauthorized users
  //unfortunately Gmap.module doesn't have this setting
  if (isset($form['coordinates'])) {
    if (!user_access('modify node data')) {
      unset($form['coordinates']);
    }
  }
  // Make a copy of the type to shorten up the code
  $type = $form['type']['#value'];
  // Is the map enabled for this content type?
  $enabled = variable_get('cambridge_mediamap_'.$type, 0);
  switch ($form_id) {
    // We need to have a way for administrators to indicate which content
    // types should have the additional media map information added.
    case $type.
    '_node_settings':
      $form['workflow']['cambridge_mediamap_'.$type] = array('#type' =&gt; 'radios', '#title' =&gt; t('Cambridge Mediamap setting'), '#default_value' =&gt; $enabled, '#options' =&gt; array(0 =&gt; t('Disabled'), 1 =&gt; t('Enabled')), '#description' =&gt; t('Allow the attaching of externally hosted imbedded video to be displayed in a map?'), );
      break;
    case $type.
    '_node_form':
      if ($enabled <span class="err">&amp;&amp;</span> user_access('modify node data')) {
        //create the fieldset
        $form['cambridge_mediamap'] = array('#type' =&gt; 'fieldset', '#title' =&gt; t('Media Map'), '#collapsible' =&gt; TRUE, '#collapsed' =&gt; FALSE, '#tree' =&gt; TRUE, );
        //insert the embed code
        $form['cambridge_mediamap']['embed'] = array('#type' =&gt; 'textarea', '#title' =&gt; t('Video Embed Code'), '#default_value' =&gt; $form['#node'] - &gt; cambridge_mediamap['embed'], '#cols' =&gt; 60, '#rows' =&gt; 5, '#description' =&gt; t('Copy and paste the embed code from an external video or media hosting service'), );
        //enable or disable on map
        $form['cambridge_mediamap']['display'] = array('#type' =&gt; 'select', '#title' =&gt; t('Display this node'), '#default_value' =&gt; $form['#node'] - &gt; cambridge_mediamap['display'], '#options' =&gt; array('0' =&gt; t('Disable display'), '1' =&gt; t('Enable display'), ), );
      }
      break;
  }
}
/\*\*\ * A page callback to draw the map\ * /

function cambridge_mediamap_map() {
  $output = '';
  //Collect the nodes to be displayed
  $results = db_query('SELECT embed, nid FROM {cambridge_mediamap} WHERE display = 1');
  //Initialize our marker array
  $markers = array();
  //check to see what modules are enabled
  $location_enabled = module_exist('location');
  $gmap_location_enabled = module_exist('gmap_location');
  //load each node and set it's attributes in the marker array
  while ($item = db_fetch_object($results)) {
    $latitude = 0;
    $longitude = 0;
    //load the node
    $node = node_load(array('nid' =&gt; $item - &gt; nid));
    //set the latitude and longitude
    //give location module data preference over gmap module data
    if ($location_enabled) {
      $latitude = $node - &gt; location['latitude'];
      $longitude = $node - &gt; location['longitude'];
    }
    elseif($gmap_location_enabled) {
      $latitude = $node - &gt; gmap_location_latitude;
      $longitude = $node - &gt; gmap_location_longitude;
    }
    if ($latitude <span class="err">&amp;&amp;</span> $longitude) {
      $markers[] = array('label' =&gt; theme('cambridge_mediamap_marker', $node), 'latitude' =&gt; $latitude, 'longitude' =&gt; $longitude, 'markername' =&gt; variable_get('cambridge_mediamap_default_marker', 'marker'), );
    }
  }
  $latlon = explode(',', variable_get('cambridge_mediamap_default_latlong', '42.369452,-71.100426'));
  $map = array('id' =&gt; 'cambridge_mediamap', 'latitude' =&gt; trim($latlon[0]), 'longitude' =&gt; trim($latlon[1]), 'width' =&gt; variable_get('cambridge_mediamap_default_width', '100%'), 'height' =&gt; variable_get('cambridge_mediamap_default_height', '500px'), 'zoom' =&gt; variable_get('cambridge_mediamap_default_zoom', 13), 'control' =&gt; variable_get('cambridge_mediamap_default_control', 'Large'), 'type' =&gt; variable_get('cambridge_mediamap_default_type', 'Satellite'), 'markers' =&gt; $markers, );
  return gmap_draw_map($map);
}
/\*\*\ * A theme
function
for our markers\ * /

function theme_cambridge_mediamap_marker($node) {
  $output = '
  ';
  $output. = '
  ' . l($node-&gt;title, '
  node / ' . $node-&gt;nid) . '
  ';
  $output. = '
  ' . $node-&gt;cambridge_mediamap['
  embed_resize '] . '
  ';
  $output. = '
  ';
  return $output;
}
/\*\*\ * Settings page\ * /

function cambridge_mediamap_settings() {
  // Cambridge data
  // latitude = 42.369452
  // longitude = -71.100426
  $form['defaults'] = array('#type' =&gt; 'fieldset', '#title' =&gt; t('Default map settings'), );
  $form['defaults']['cambridge_mediamap_default_width'] = array('#type' =&gt; 'textfield', '#title' =&gt; t('Default width'), '#default_value' =&gt; variable_get('cambridge_mediamap_default_width', '100%'), '#size' =&gt; 25, '#maxlength' =&gt; 6, '#description' =&gt; t('The default width of a Google map. Either px or %'), );
  $form['defaults']['cambridge_mediamap_default_height'] = array('#type' =&gt; 'textfield', '#title' =&gt; t('Default height'), '#default_value' =&gt; variable_get('cambridge_mediamap_default_height', '500px'), '#size' =&gt; 25, '#maxlength' =&gt; 6, '#description' =&gt; t('The default height of Mediamap. In px.'), );
  $form['defaults']['cambridge_mediamap_default_latlong'] = array('#type' =&gt; 'textfield', '#title' =&gt; t('Default center'), '#default_value' =&gt; variable_get('cambridge_mediamap_default_latlong', '42.369452,-71.100426'), '#description' =&gt; 'The decimal latitude,longitude of the centre of the map. The "." is used for decimal, and "," is used to separate latitude and longitude.', '#size' =&gt; 50, '#maxlength' =&gt; 255, '#description' =&gt; t('The default longitude, latitude of Mediamap.'), );
  $form['defaults']['cambridge_mediamap_default_zoom'] = array('#type' =&gt; 'select', '#title' =&gt; t('Default zoom'), '#default_value' =&gt; variable_get('cambridge_mediamap_default_zoom', 13), '#options' =&gt; drupal_map_assoc(range(0, 17)), '#description' =&gt; t('The default zoom level of Mediamap.'), );
  $form['defaults']['cambridge_mediamap_default_control'] = array('#type' =&gt; 'select', '#title' =&gt; t('Default control type'), '#default_value' =&gt; variable_get('cambridge_mediamap_default_control', 'Large'), '#options' =&gt; array('None' =&gt; t('None'), 'Small' =&gt; t('Small'), 'Large' =&gt; t('Large')), );
  $form['defaults']['cambridge_mediamap_default_type'] = array('#type' =&gt; 'select', '#title' =&gt; t('Default map type'), '#default_value' =&gt; variable_get('cambridge_mediamap_default_type', 'Satellite'), '#options' =&gt; array('Map' =&gt; t('Map'), 'Satellite' =&gt; t('Satellite'), 'Hybrid' =&gt; t('Hybrid')), );
  $markers = gmap_get_markers();
  $form['defaults']['cambridge_mediamap_default_marker'] = array('#type' =&gt; 'select', '#title' =&gt; t('Marker'), '#default_value' =&gt; variable_get('cambridge_mediamap_default_marker', 'marker'), '#options' =&gt; $markers, );
  $form['embed'] = array('#type' =&gt; 'fieldset', '#title' =&gt; t('Default embedded video settings'), );
  $form['embed']['cambridge_mediamap_embed_width'] = array('#type' =&gt; 'textfield', '#title' =&gt; t('Default width'), '#default_value' =&gt; variable_get('cambridge_mediamap_embed_width', '320'), '#size' =&gt; 25, '#maxlength' =&gt; 6, '#description' =&gt; t('The maximum width of embedded video'), );
  $form['embed']['cambridge_mediamap_embed_height'] = array('#type' =&gt; 'textfield', '#title' =&gt; t('Default height'), '#default_value' =&gt; variable_get('cambridge_mediamap_embed_height', '240'), '#size' =&gt; 25, '#maxlength' =&gt; 6, '#description' =&gt; t('The maximum height of embedded video.'), );
  return $form;
}
/\*\*\ * Prints human - readable(html) information about a variable.\*Use: print debug($variable_name);\ * Or assign output to a variable.\*/

function debug($value) {
  return preg_replace("/\s/", " ", preg_replace("/\n/", "", print_r($value, true)));
}
</code></pre>
</div>

        </div>
      </li>
    
      <li>
        <span class="post-meta">Aug 1, 2007</span>

        <h2>
          <a class="post-link" href="/2007/08/01/Walkabout-Trail-RI.html.html">Walkabout Trail, RI</a>
        </h2>

        <div class="post-content" itemprop="articleBody">
          <p><a href="http://www.flickr.com/photos/bensheldon/819325062/" title="Photo Sharing"> <img src="http://farm2.static.flickr.com/1327/819325062_64e6660ffa_m.jpg" alt="Frog" /> </a> <a href="http://www.flickr.com/photos/bensheldon/818413293/" title="Photo Sharing"> <img src="http://farm2.static.flickr.com/1054/818413293_f3c656f1ce_m.jpg" alt="Helen sees something" /> </a></p>

<p>A few weeks ago I hiked the <a href="http://www.google.com/maps?q=Providence,+RI,+USA&amp;ie=UTF8&amp;ll=41.92353,-71.75776&amp;spn=0.00372,0.009388&amp;t=h&amp;z=17&amp;om=1">Walkabout Trail</a> in Northwestern Rhode Island with my friend <a href="http://flickr.com/photos/helenday/">Helen</a>. The trail was gorgeously green and mossy with many fun frogs, toads and critters. We hiked the eight miles (which cuts for shorter walks) in a little over three hours, which was a great pace leading up to a cooling swim in the adjoining pond afterwards.</p>

<p><a href="http://flickr.com/photos/bensheldon/sets/72157600835146342/"> <img src="/assets/2007-08/walkabout-trail.png" alt="" /> </a></p>

        </div>
      </li>
    
      <li>
        <span class="post-meta">Jul 19, 2007</span>

        <h2>
          <a class="post-link" href="/2007/07/19/Should-I-get-a-nonprofit-job.html.html">"Should I get a nonprofit job?"</a>
        </h2>

        <div class="post-content" itemprop="articleBody">
          <p>I have a lot of friends and acquaintances considering a job in the nonprofit sector. I’ve been employed within small (under $2 million budgets), community nonprofit organizations for three years now, beginning straight out of college, but have also talked to many people with many different experiences and histories in the sector and outside of it about their experiences. The following is my boilerplate advice to people that asks me about working, or finding work, within nonprofits.</p>

<p>Assuming that you are an intelligent, well-educated (or seeking to be), self-motivated and upwardly mobile individual, your interest probably spans a combination of two distinct (or should be in your mind) issues:</p>

<ul>
  <li>You want a job, with a modicum of stability, freedom, and disposable income.</li>
  <li>You want to change the world, or a least do it less harm than otherwise.</li>
</ul>

<p><strong>My advice for you:</strong></p>

<blockquote>

</blockquote>

<blockquote>
  <p>Find a corporate job that you like, or don’t feel too guilty about, and that provides you with plenty of disposable income and time. Find a small, local nonprofit (or church, or social group) that meets your standards for doing good, and invest your disposable income and time with them. Join their governing board, connect them with your professional and personal networks and help them grow in a direction you believe in. You will enact more change from a higher level than you could, in most situations, by being a direct employee of that organization.</p>
</blockquote>

<p><strong>Non-categorical rationale:</strong></p>

<p>Nonprofits have jobs, but they don’t have a lot of them and it’s hard to break into one that distinguishes you from your peers: you can find a job answering phones, but it’s difficult to get one with responsibility and authority. Nonprofits are bad (or relatively worse than their commercial peers) at: recognizing ability, enabling it, and rewarding it.</p>

<p>Nonprofits are insulating. Because you are constantly understaffed, under-budgeted and under-resourced (time, training, equipment) it is difficult to find the time to truly reflect. It is difficult to critically look at what you are doing and what you have done; to connect with other practitioners and look at what you are doing as a group; to reach outside the sector to learn from others and see how you fit into that broadest context.</p>

<p>A job is a job, wherever you’re working. This may sound selfish (and it probably is) but you should be concerned that, whatever your job is, you:</p>

<ol>
  <li>are challenged</li>
  <li>are encouraged to try and learn new things</li>
  <li>are acknowledged (even celebrated on occassion)</li>
  <li>can advance to greater responsibility and authority</li>
  <li>are provided a separate personal life</li>
  <li>are afforded physical and mental health (no 80 hour weeks or screaming matches)</li>
  <li>have fun or enjoy your work a majority of the time (no puritan work ethic for me)</li>
</ol>

<p>By looking after yourself on an individual level, you will ultimately be in a better position to have compassion for those around you and be better positioned to act upon that compassion.</p>

        </div>
      </li>
    
      <li>
        <span class="post-meta">Jul 15, 2007</span>

        <h2>
          <a class="post-link" href="/2007/07/15/Planning-Strategic-Planning.html.html">Planning Strategic Planning</a>
        </h2>

        <div class="post-content" itemprop="articleBody">
          <p>At work I have been furiously engaged in strategic planning in advance of some major grant-writing. This process is a continuation from some vine-withered efforts my coworker and I had made last fall, but due to some changing circumstances—a better understanding of the existing processes at play and increased authority to manage the outcomes—this most recent effort is bearing more fruit.</p>

<p>Perhaps the largest set-back to our strategic planning projects has been <em>the planning of our strategic planning</em>. Without having to recurse infinitely backwards, perhaps the most important things I’ve learned are:</p>

<ul>
  <li>
    <p><strong>Strategic planning relies on individuals.</strong> Strategic planning usually requires the actions of a single, or a small handful of individuals that not only are motivated, but have the resources and authority (or the full backing of someone with authority) to proceed. This is not to diminish the value of <a href="http://en.wikipedia.org/wiki/Swot_analysis">SWOT</a> or <a href="http://en.wikipedia.org/wiki/SMART_(project_management)">SMART</a>, but to reaffirm that strategic planning relies upon someone to begin the process, facilitate it, and ensure that its outcomes are useful.</p>
  </li>
  <li>
    <p><strong>Strategic planning should build on your strengths.</strong> There is a tendency to relegate strategic planning activities to weak periods or to use it to shore up areas that are perceived lacking. This often means that you aren’t able to properly recognize what led to successful periods or why certain components succeeded.</p>
  </li>
  <li>
    <p><strong>Define goals by need, not by resources or activities.</strong> Perhaps due to the tendency to use strategic planning to shore up weaknesses, goals are often defined narrowly out of current activities. Rather, goals should be widest effect you hope to enact. Just because a program’s goals are narrow does not mean that an organization cannot hope to affect a broader mission; or that a program cannot target only a single need within a much larger issue.</p>
  </li>
</ul>

<p>These three pieces come from my own experience with strategic planning, but I do like that they tie in nicely with much broader advice on philanthropy from Peter Drucker (via <a href="http://giving.typepad.com/theworldwewant/2006/05/update_on_the_w.html">The World We Want</a>):</p>

<ol>
  <li>
    <p>Fund extraordinary people, not institutions.</p>
  </li>
  <li>
    <p>Build on islands of health, not problems to be solved.</p>
  </li>
  <li>
    <p>Get big or get gone. Scale up to the size of the need, not down to the resources available.</p>
  </li>
</ol>

<p>(I’m always looking this quote up for a variety of reasons, so for simplicities sake I figure I should just post it here.)</p>

        </div>
      </li>
    
  </ul>

  <!-- Pagination links -->
  <div class="pagination">
    
      <span class="previous">Previous</span>
    
    <span class="page_number ">Page: 1 of 21</span>
    
      <a href="/page2" class="next">Next</a>
    
  </div>

  <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Island94.org</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Island94.org</li>
          <li><a href="mailto:bensheldon@gmail.com">bensheldon@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/bensheldon"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">bensheldon</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/bensheldon"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">bensheldon</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A Lost and Found
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
